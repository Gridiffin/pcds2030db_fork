function l(t){return!t||t<=0?(console.warn("Invalid submission ID provided:",t),!1):!0}function d(t){const e={total:0,on_track:0,at_risk:0,behind:0,completed:0};return Array.isArray(t)&&(e.total=t.length,t.forEach(n=>{const a=n.status_indicator||"unknown";e.hasOwnProperty(a)&&e[a]++})),e}function u(t){if(!t||t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,a)).toFixed(2))+" "+n[a]}function f(){if(window.APP_URL)return window.APP_URL;const e=window.location.pathname.split("/");let n=-1;for(let a=0;a<e.length;a++)if(e[a]==="app"&&e[a+1]==="views"){n=a;break}return n>0?e.slice(0,n).join("/"):window.location.origin+window.location.pathname.split("/").slice(0,-4).join("/")}function m(){document.querySelectorAll('[data-action="submit-submission"]').forEach(a=>{a.addEventListener("click",p)}),document.querySelectorAll('[data-action="edit-submission"]').forEach(a=>{a.addEventListener("click",g)}),document.querySelectorAll('[data-action="add-submission"]').forEach(a=>{a.addEventListener("click",b)})}function p(t){t.preventDefault();const e=t.currentTarget,n=e.dataset.submissionId||window.submissionId,a=window.programId;if(!n){console.error("No submission ID found for submit action");return}if(!confirm("Are you sure you want to submit this submission for review? Once submitted, you may not be able to edit it."))return;e.classList.add("loading"),e.disabled=!0;const s=`${f()}/app/views/agency/programs/submit_submission.php?submission_id=${n}&program_id=${a}`;window.location.href=s}function g(t){const n=t.currentTarget.href;if(!n||n==="#"){t.preventDefault(),console.error("Edit submission link has no valid href");return}console.log("Navigating to edit submission:",n)}function b(t){const n=t.currentTarget.href;if(!n||n==="#"){t.preventDefault(),console.error("Add submission link has no valid href");return}console.log("Navigating to add submission:",n)}function w(){h(),y(),L()}function h(){const t=document.querySelector(".targets-container");if(!t)return;const e=t.querySelectorAll(".target-card"),n=Array.from(e).map(i=>({status_indicator:i.dataset.status||"unknown"})),a=d(n);v(a)}function v(t){const e=document.querySelector(".target-stats");if(!e)return;const n={total:e.querySelector('[data-stat="total"]'),on_track:e.querySelector('[data-stat="on_track"]'),at_risk:e.querySelector('[data-stat="at_risk"]'),behind:e.querySelector('[data-stat="behind"]'),completed:e.querySelector('[data-stat="completed"]')};Object.keys(n).forEach(a=>{const i=n[a];i&&(i.textContent=t[a]||0)})}function y(){document.querySelectorAll(".target-card").forEach(e=>{e.addEventListener("mouseenter",k),e.addEventListener("mouseleave",S),e.addEventListener("click",E)})}function k(t){const e=t.currentTarget;e.style.transform="translateY(-2px)",e.style.boxShadow="0 0.5rem 1rem rgba(40, 167, 69, 0.2)"}function S(t){const e=t.currentTarget;e.style.transform="",e.style.boxShadow=""}function E(t){const n=t.currentTarget.dataset.targetId;n&&console.log("Target card clicked:",n)}function L(){document.querySelectorAll(".target-status").forEach(e=>{e.addEventListener("click",T)})}function T(t){t.stopPropagation();const n=t.currentTarget.dataset.status;console.log("Status clicked:",n)}function A(){C(),q(),M()}function C(){document.querySelectorAll('[data-action="download-attachment"]').forEach(e=>{e.addEventListener("click",x)})}function x(t){const e=t.currentTarget,n=e.dataset.attachmentId,a=e.dataset.fileName;if(!n){console.warn("No attachment ID found for download");return}z(e),console.log("Downloading attachment:",a||n)}function q(){document.querySelectorAll('[data-action="preview-attachment"]').forEach(e=>{e.addEventListener("click",I)})}function I(t){t.preventDefault();const e=t.currentTarget,n=e.href,a=e.dataset.fileName,i=D(a);P(i)?_(n,a,i):window.open(n,"_blank")}function M(){document.querySelectorAll("[data-file-size]").forEach(e=>{const n=parseInt(e.dataset.fileSize);n&&(e.textContent=u(n))})}function z(t){const e=t.querySelector("i");e&&(e.className="fas fa-spinner fa-spin"),t.style.opacity="0.7",t.style.pointerEvents="none"}function D(t){return t?t.split(".").pop().toLowerCase():""}function P(t){return["pdf","jpg","jpeg","png","gif","txt","md"].includes(t)}function _(t,e,n){let a=document.getElementById("attachmentPreviewModal");a||(a=B(),document.body.appendChild(a)),N(a,t,e,n),new bootstrap.Modal(a).show()}function B(){const t=document.createElement("div");return t.id="attachmentPreviewModal",t.className="modal fade",t.setAttribute("tabindex","-1"),t.setAttribute("aria-hidden","true"),t.innerHTML=`
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-file me-2"></i>
                        <span class="file-name">Preview</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="preview-container text-center">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                            <p class="mt-2">Loading preview...</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-primary download-btn" target="_blank">
                        <i class="fas fa-download me-2"></i>Download
                    </a>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    `,t}function N(t,e,n,a){const i=t.querySelector(".file-name"),r=t.querySelector(".preview-container"),s=t.querySelector(".download-btn");i.textContent=n,s.href=e;let o="";switch(a){case"pdf":o=`<iframe src="${e}" style="width: 100%; height: 500px; border: none;"></iframe>`;break;case"jpg":case"jpeg":case"png":case"gif":o=`<img src="${e}" class="img-fluid" alt="${n}" style="max-height: 500px;">`;break;default:o=`
                <div class="text-center py-4">
                    <i class="fas fa-file fa-3x text-muted mb-3"></i>
                    <p>Preview not available for this file type.</p>
                    <p class="text-muted">Click download to view the file.</p>
                </div>
            `}r.innerHTML=o}function c(){console.log("Initializing view submissions page..."),m(),w(),A(),window.submissionId&&l(window.submissionId),console.log("View submissions page initialized successfully")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c();

const d={"target-achieved":"#28a745",completed:"#28a745","on-track":"#ffc107","on-track-yearly":"#ffc107",delayed:"#dc3545","severe-delay":"#dc3545","not-started":"#6c757d"},u={"target-achieved":"Target Achieved",completed:"Completed","on-track":"On Track","on-track-yearly":"On Track (Yearly)",delayed:"Delayed","severe-delay":"Severe Delay","not-started":"Not Started"};function f(e){if(!e)return console.error("No element provided for parsing rating data"),null;try{const t=e.textContent||e.innerText;return JSON.parse(t)}catch(t){return console.error("Failed to parse rating data:",t),null}}function g(e){const t=[],n=[],a=[];if(!e||typeof e!="object")return{labels:t,data:n,colors:a};for(const[i,o]of Object.entries(e))if(o>0){const s=u[i]||i,r=d[i]||"#6c757d";t.push(s),n.push(o),a.push(r)}return{labels:t,data:n,colors:a}}function h(e){return{type:"doughnut",data:{labels:e.labels,datasets:[{data:e.data,backgroundColor:e.colors,borderWidth:2,borderColor:"#ffffff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom",labels:{padding:20,usePointStyle:!0}},tooltip:{callbacks:{label:function(t){const n=t.label||"",a=t.raw||0,i=t.dataset.data.reduce((s,r)=>s+r,0),o=i>0?Math.round(a/i*100):0;return`${n}: ${a} (${o}%)`}}}},cutout:"70%"}}}function p(){const e=[];return typeof Chart>"u"&&e.push("Chart.js library"),{success:e.length===0,missing:e}}function c(e,t=""){const n={"chart-error":`
            <div class="text-muted text-center py-4">
                <i class="fas fa-exclamation-triangle fa-2x mb-3 text-warning"></i>
                <div>Error loading chart. Please refresh the page.</div>
                ${t?`<div class="small mt-2">${t}</div>`:""}
            </div>
        `,"no-data":`
            <div class="text-muted text-center py-4">
                <i class="fas fa-chart-pie fa-2x mb-3"></i>
                <div>No program rating data available for this initiative.</div>
            </div>
        `,dependencies:`
            <div class="text-muted text-center py-4">
                <i class="fas fa-exclamation-circle fa-2x mb-3 text-danger"></i>
                <div>Required dependencies not loaded.</div>
                ${t?`<div class="small mt-2">${t}</div>`:""}
            </div>
        `};return n[e]||n["chart-error"]}function m(e="initiativeRatingChart",t="ratingData"){const n=document.getElementById(e),a=document.getElementById(t);if(!n){console.error(`Canvas element with ID "${e}" not found`);return}if(!a){console.error(`Rating data element with ID "${t}" not found`);return}const i=p();if(!i.success){console.error("Missing dependencies:",i.missing);const r=n.parentElement;r.innerHTML=c("dependencies",i.missing.join(", "));return}const o=f(a);if(!o){const r=n.parentElement;r.innerHTML=c("no-data");return}const s=g(o);if(s.data.length>0)try{const r=h(s);new Chart(n,r)}catch(r){console.error("Error creating chart:",r);const l=n.parentElement;l.innerHTML=c("chart-error",r.message)}else{const r=n.parentElement;r.innerHTML=c("no-data")}}function v(){const e=document.querySelector('form[method="GET"]');if(!e)return;const t=e.querySelector('input[name="search"]'),n=e.querySelector('select[name="status"]');t&&t.addEventListener("keypress",function(a){a.key==="Enter"&&e.submit()}),n&&n.addEventListener("change",function(){e.submit()})}function b(){typeof bootstrap<"u"&&bootstrap.Tooltip&&[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(t){return new bootstrap.Tooltip(t)})}function y(){document.querySelectorAll('button[type="submit"], .btn[href]').forEach(t=>{t.addEventListener("click",function(){if(this.tagName==="BUTTON"){const n=this.innerHTML;this.innerHTML='<i class="fas fa-spinner fa-spin me-1"></i>Loading...',this.disabled=!0,setTimeout(()=>{this.innerHTML=n,this.disabled=!1},5e3)}})})}function L(){const e=document.querySelector(".initiatives-table, .table");if(!e)return;e.querySelectorAll("tbody tr").forEach(n=>{const a=n.querySelector('a[href*="view_initiative"]');a&&(n.style.cursor="pointer",n.addEventListener("click",function(i){i.target.tagName==="A"||i.target.tagName==="BUTTON"||i.target.closest("a, button")||a.click()})),n.addEventListener("mouseenter",function(){this.style.backgroundColor="rgba(13, 110, 253, 0.05)"}),n.addEventListener("mouseleave",function(){this.style.backgroundColor=""})})}function T(){console.log("Initializing initiatives listing page..."),v(),b(),y(),L(),E(),console.log("Initiatives listing page initialized successfully")}function E(){const e=document.querySelector('a[href*="initiatives.php"]:not([href*="view_initiative"])');e&&e.addEventListener("click",function(t){this.innerHTML,this.innerHTML='<i class="fas fa-spinner fa-spin me-1"></i>Resetting...',setTimeout(()=>{window.location.href=this.href},300)})}function C(){const e=document.querySelector(".table-responsive table");if(!e)return;const t=e.parentElement;function n(){if(t.scrollWidth>t.clientWidth&&window.innerWidth<=768){if(!t.querySelector(".scroll-indicator")){const i=document.createElement("div");i.className="scroll-indicator alert alert-info alert-sm",i.innerHTML='<i class="fas fa-arrows-alt-h me-1"></i>Scroll horizontally to see more columns',t.parentElement.insertBefore(i,t)}}else{const i=t.parentElement.querySelector(".scroll-indicator");i&&i.remove()}}n(),window.addEventListener("resize",n)}document.addEventListener("DOMContentLoaded",function(){console.log("Agency Initiatives module loading...");const e=document.getElementById("initiativeRatingChart")!==null,t=document.querySelector(".initiatives-table, .table")!==null;e&&(console.log("Initializing initiative view page..."),m()),t&&(console.log("Initializing initiative listing page..."),T(),C()),console.log("Agency Initiatives module loaded successfully")});

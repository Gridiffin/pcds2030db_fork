function g(e){return/^[^@]+@[^@]+\.[^@]+$/.test(e)||e.length>0}function p(e){return e.length>=8}console.log("login.js loaded");document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("loginForm"),a=document.getElementById("loginBtn"),r=document.getElementById("loginSpinner"),t=document.getElementById("username"),o=document.getElementById("password"),i=document.getElementById("loginError");t&&!t.value&&t.focus();const c=document.querySelector(".toggle-password");c&&c.addEventListener("click",function(){o.type==="password"?(o.type="text",this.querySelector("i").className="far fa-eye-slash"):(o.type="password",this.querySelector("i").className="far fa-eye")}),e&&e.addEventListener("submit",function(d){console.log("Form submit event triggered"),d.preventDefault();const m=t.value.trim(),u=o.value;if(!g(m)){s("Username or email is required");return}if(!p(u)){s("Password must be at least 8 characters");return}a.disabled=!0,r.classList.remove("d-none");const l=window.location.pathname.split("/login.php")[0];fetch(`${window.location.origin}${l}/app/api/login.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:m,password:u})}).then(n=>n.json()).then(n=>{n.success?n.role==="admin"?window.location.href=`${l}/app/views/admin/dashboard/dashboard.php`:window.location.href=`${l}/app/views/agency/dashboard/dashboard.php`:(s(n.error||"Login failed"),a.disabled=!1,r.classList.add("d-none"))}).catch(()=>{s("Network error. Please try again."),a.disabled=!1,r.classList.add("d-none")})});function s(d){i&&(i.textContent=d,i.className="alert alert-danger mt-2")}});

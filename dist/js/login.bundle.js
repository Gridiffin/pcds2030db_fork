function u(e){if(!e||typeof e!="string")return!1;const t=e.trim();return t.length===0?!1:/^[^@]+@[^@]+\.[^@]+$/.test(t)||t.length>0}function g(e){return!e||typeof e!="string"?!1:e.length>=8}console.log("login.js loaded");document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("loginForm"),t=document.getElementById("loginBtn"),a=document.getElementById("loginSpinner"),o=document.getElementById("username"),s=document.getElementById("password"),i=document.getElementById("loginError");o&&!o.value&&o.focus();const c=document.querySelector(".toggle-password");c&&c.addEventListener("click",function(){s.type==="password"?(s.type="text",this.querySelector("i").className="far fa-eye-slash"):(s.type="password",this.querySelector("i").className="far fa-eye")}),e&&e.addEventListener("submit",function(l){console.log("Form submit event triggered"),l.preventDefault();const m=o.value.trim(),f=s.value;if(!u(m)){r("Username or email is required");return}if(!g(f)){r("Password must be at least 8 characters");return}t.disabled=!0,a.classList.remove("d-none");const d=window.location.pathname.split("/login.php")[0];fetch(`${window.location.origin}${d}/app/api/login.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:m,password:f})}).then(n=>n.json()).then(n=>{n.success?n.role==="admin"?window.location.href=`${d}/app/views/admin/dashboard/dashboard.php`:window.location.href=`${d}/app/views/agency/dashboard/dashboard.php`:(r(n.error||"Login failed"),t.disabled=!1,a.classList.add("d-none"))}).catch(()=>{r("Network error. Please try again."),t.disabled=!1,a.classList.add("d-none")})});function r(l){i&&(i.textContent=l,i.className="alert alert-danger mt-2")}});
